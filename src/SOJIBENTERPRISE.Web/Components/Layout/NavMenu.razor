@inject NavigationManager NavigationManager
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">@CompanyInfo.Name</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable">
    <nav class="flex-column">

        <!-- SALES Section -->
        <AuthorizeView Roles="Admin,Manager,Sales,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("sales"))">
                        Sales
                        <span class="toggle-icon">@GetToggleIcon("sales")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("sales") ? "show" : "")">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Sales">
                                <span class="nav-menu" aria-hidden="true"></span> Sales Order
                            </NavLink>
                        </div>
                        
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ProductSalesHistory">
                                <span class="nav-menu" aria-hidden="true"></span>Product Sales History
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="SalesReturn">
                                <span class="nav-menu" aria-hidden="true"></span> Sales Return History
                            </NavLink>
                        </div>
                       
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>


        <!-- Due Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("due"))">
                        Due & Payment
                        <span class="toggle-icon">@GetToggleIcon("due")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("due") ? "show" : "")">

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="CustomerDuesHistory">
                                <span class="nav-menu" aria-hidden="true"></span>DSR Due History
                            </NavLink>
                        </div>
                       @*  <div class="nav-item px-3">
                            <NavLink class="nav-link" href="SRDiscountList">
                                <span class="nav-menu" aria-hidden="true"></span> SR Due List
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ShopDues">
                                <span class="nav-menu" aria-hidden="true"></span> Shop Due List
                            </NavLink>
                        </div> *@
                        @* <div class="nav-item px-3">
                            <NavLink class="nav-link" href="PaymentHistory">
                                <span class="nav-menu" aria-hidden="true"></span>DSR Payment History
                            </NavLink>
                        </div> *@
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="SRPaymentHistory">
                                <span class="nav-menu" aria-hidden="true"></span> SR Payment History
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ShopPaymentHistory">
                                <span class="nav-menu" aria-hidden="true"></span>Shop Payment History
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ShopDuePayment">
                                <span class="nav-menu" aria-hidden="true"></span>Shop Due Payment List
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- PURCHASES Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("purchases"))">
                        Purchases
                        <span class="toggle-icon">@GetToggleIcon("purchases")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("purchases") ? "show" : "")">
                        
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Purchases">
                                <span class="nav-menu" aria-hidden="true"></span> Purchases
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="SupplierDuesHistory">
                                <span class="nav-menu" aria-hidden="true"></span> Due List
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="SupplierPaymentHistory">
                                <span class="nav-menu" aria-hidden="true"></span> Payment History
                            </NavLink>
                        </div>
                       
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- Products Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("products"))">
                        Products
                        <span class="toggle-icon">@GetToggleIcon("products")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("products") ? "show" : "")">
                       
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Products">
                                <span class="nav-menu" aria-hidden="true"></span> Products
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ReOrders">
                                <span class="nav-menu" aria-hidden="true"></span> Re-Orders List
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>


        <!-- Expenses Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("expenses"))">
                        Expenses
                        <span class="toggle-icon">@GetToggleIcon("expenses")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("expenses") ? "show" : "")">
                        
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ProductAdjustment">
                                <span class="nav-menu" aria-hidden="true"></span> Stock Adjustment
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Expenses">
                                <span class="nav-menu" aria-hidden="true"></span> Monthly Expenses
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DailyExpense">
                                <span class="nav-menu" aria-hidden="true"></span> Daily Expenses
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- Damage Product Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("damageProduct"))">
                        Damage Product
                        <span class="toggle-icon">@GetToggleIcon("damageProduct")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("damageProduct") ? "show" : "")">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DamageStock">
                                <span class="nav-menu" aria-hidden="true"></span> Damage Stock
                            </NavLink>
                        </div>
                        @* <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DamageProductStockList">
                                <span class="nav-menu" aria-hidden="true"></span> Damage Product Stock
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DamageProducts">
                                <span class="nav-menu" aria-hidden="true"></span> Damage Product List
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DamageProductHandover">
                                <span class="nav-menu" aria-hidden="true"></span> Damage Handover
                            </NavLink>
                        </div> 
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DamageProductHandoverList">
                                <span class="nav-menu" aria-hidden="true"></span> Product Handover List
                            </NavLink>
                        </div>*@
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DamageProductHandoverSummary">
                                <span class="nav-menu" aria-hidden="true"></span> Handover Summary
                            </NavLink>
                        </div>

                    </div>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- LOOKUP Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("lookup"))">
                        Shared Data
                        <span class="toggle-icon">@GetToggleIcon("lookup")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("lookup") ? "show" : "")">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ProductCategory">
                                <span class="nav-menu" aria-hidden="true"></span> Categories
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Packaging">
                                <span class="nav-menu" aria-hidden="true"></span> Packaging
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="UnitOfMeasurement">
                                <span class="nav-menu" aria-hidden="true"></span> Unit of Measurement
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Size">
                                <span class="nav-menu" aria-hidden="true"></span> Product Size
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="CustomerType">
                                <span class="nav-menu" aria-hidden="true"></span> Staff Type
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ExpenseType">
                                <span class="nav-menu" aria-hidden="true"></span>  Monthly Expenses Type
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="DailyExpenseType">
                                <span class="nav-menu" aria-hidden="true"></span> Daily Expense Type
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="PaymentMethod">
                                <span class="nav-menu" aria-hidden="true"></span> Payment Method
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ShippingMethod">
                                <span class="nav-menu" aria-hidden="true"></span> Shipping Method
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ReasonofAdjustment">
                                <span class="nav-menu" aria-hidden="true"></span> Adjustment
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Road">
                                <span class="nav-menu" aria-hidden="true"></span> Road
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Shop">
                                <span class="nav-menu" aria-hidden="true"></span> Shop
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- Manage User Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("admin"))">
                        Manage User
                        <span class="toggle-icon">@GetToggleIcon("admin")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("admin") ? "show" : "")">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Customers">
                                <span class="nav-menu" aria-hidden="true"></span> Staff
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="AddEditSupplier">
                                <span class="nav-menu" aria-hidden="true"></span> Suppliers
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="ManageUser">
                                <span class="nav-menu" aria-hidden="true"></span> Manage User
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="MyCompany">
                                <span class="nav-menu" aria-hidden="true"></span> My Business
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>
        
        <!-- History Section -->
        <AuthorizeView Roles="Admin,Manager,Administrator">
            <Authorized>
                <div class="nav-group">
                    <div class="nav-group-title" @onclick="@(() => ToggleSection("history"))">
                        History
                        <span class="toggle-icon">@GetToggleIcon("history")</span>
                    </div>
                    <div class="nav-submenu @(IsSectionOpen("history") ? "show" : "")">
                        
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="TransactionHistory">
                                <span class="nav-menu" aria-hidden="true"></span> Transaction History
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="Graphs">
                                <span class="nav-menu" aria-hidden="true"></span> Chart History
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>
        

    </nav>
</div>


@code {

    [Inject]
    private ICompany m_Company { get; set; }

    private CompanyInfo CompanyInfo { get; set; }


    protected override void OnInitialized()
    {
        CompanyInfo = m_Company.GetCompanyInfo();
    }

    private Dictionary<string, bool> sectionStates = new()
    {
        { "sales", false },
        { "purchases", false },
        { "products", false },
        { "damageProduct", false },
        { "history", false },
        { "due", false },
        { "expenses", false },
        { "lookup", false },
        { "admin", false }
    };

    private void ToggleSection(string sectionName)
    {
        sectionStates[sectionName] = !sectionStates[sectionName];
    }

    private bool IsSectionOpen(string sectionName)
    {
        return sectionStates.TryGetValue(sectionName, out var isOpen) && isOpen;
    }

    private string GetToggleIcon(string sectionName)
    {
        return IsSectionOpen(sectionName) ? "▼" : "►";
    }
}